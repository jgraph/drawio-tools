<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Convert CSV data into draw.io diagrams with custom styling and connections">
  <title>CSV Import - draw.io Tools</title>
  <link rel="icon" type="image/svg+xml" href="../assets/favicon.svg">
  <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
  <div class="page">
    <header class="header">
      <div class="container">
        <div class="header__inner">
          <a href="../" class="header__brand">
            <img src="../assets/logo.svg" alt="draw.io" class="header__logo">
            <span class="header__title">draw.io Tools</span>
          </a>
          <nav class="header__nav">
            <a href="../" class="header__link">All Tools</a>
            <a href="https://github.com/jgraph/drawio-tools" class="header__link" target="_blank">GitHub</a>
          </nav>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="container tool-page">
        <nav class="breadcrumb">
          <a href="../" class="breadcrumb__link">Tools</a>
          <span class="breadcrumb__separator">/</span>
          <span class="breadcrumb__current">CSV Import</span>
        </nav>

        <div class="tool-header">
          <h1 class="tool-header__title">
            <svg class="tool-header__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <path d="M14 2v6h6"/>
              <line x1="8" y1="13" x2="16" y2="13"/>
              <line x1="8" y1="17" x2="16" y2="17"/>
            </svg>
            CSV Import
          </h1>
          <p class="tool-header__description">
            Convert CSV data into draw.io diagrams with custom styling, connections, and automatic layout options.
          </p>
        </div>

        <div class="mb-sm">
          <label for="url">CSV URL (optional)</label>
          <input
            type="url"
            id="url"
            placeholder="https://jgraph.github.io/drawio-diagrams/diagrams/orgchart.csv"
            autocomplete="off"
          >
        </div>

        <div class="mb-sm">
          <label for="title">Diagram Title (optional)</label>
          <input type="text" id="title" placeholder="My Org Chart">
        </div>

        <div class="textarea-container mb-sm">
          <label for="desc">Configuration</label>
          <textarea id="desc" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off" rows="20">#
# Example CSV import. Use # for comments. Paste CSV below.
# Reserved names: id, tooltip, placeholder(s), link and label
#

# Node label with placeholders and HTML.
# Default is '%name_of_first_column%'.

label: %name%<br><i style="color:gray;">%position%</i><br><a href="mailto:%email%">Email</a>

# Node style (placeholders are replaced once).

style: label;image=%image%;whiteSpace=wrap;html=1;rounded=1;fillColor=%fill%;strokeColor=%stroke%;

# Parent style for nodes with child nodes.

parentstyle: swimlane;whiteSpace=wrap;html=1;childLayout=stackLayout;horizontal=1;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;

# Style for objects not in CSV. Use - to ignore them.

unknownStyle: -

# Optional column name that contains a reference to a named style.

stylename: -

# JSON for named styles: {"name": "style", ...}

styles: -

# JSON for variables in styles: {"name": "value", ...}

vars: -

# Optional column name for named label reference.

labelname: -

# JSON for named labels: {"name": "label", ...}

labels: -

# Column name as identity for cells (updates existing cells).

identity: -

# Column name as parent reference for cells.

parent: -

# Prefix added to cell identity to avoid collisions.

namespace: csvimport-

# Connections between rows.
# "from": source column, "to": target column
# Optional: label, style, invert, placeholders, data

connect: {"from": "manager", "to": "name", "invert": true, "label": "manages", \
    "style": "curved=1;endArrow=blockThin;endFill=1;fontSize=11;"}
connect: {"from": "refs", "to": "id", "style": "curved=1;fontSize=11;"}

# Node position columns

left:
top:

# Node dimensions (number, auto, or @columnName)

width: auto
height: auto

# Collapsed state for vertices

collapsed: false

# Padding for autosize

padding: -12

# Ignored columns for metadata (can be used for connections/styles)

ignore: id,image,fill,stroke,refs,manager

# Column to rename to link attribute

link: url

# Layout spacing

nodespacing: 40
levelspacing: 100
edgespacing: 40

# Layout type: auto, none, verticaltree, horizontaltree,
# verticalflow, horizontalflow, organic, circle, orgchart

layout: auto
</textarea>
        </div>

        <div class="btn-row mb-sm">
          <button type="button" class="btn btn--primary" id="createBtn">Generate Link</button>
          <button type="button" class="btn btn--primary" id="openBtn" style="display: none;">Open</button>
          <button type="button" class="btn btn--secondary" id="copyBtn" style="display: none;">Copy</button>
        </div>

        <div id="resultCard" style="display: none;">
          <a href="" target="_blank" id="resultLink" style="word-break: break-all; font-size: var(--font-size-xs);"></a>
        </div>

        <div id="alertContainer" class="mt-lg"></div>
      </div>
    </main>

    <footer class="footer">
      <div class="container">
        <div class="footer__inner">
          <span>&copy; 2026 JGraph Ltd. Apache-2.0 License.</span>
          <div class="footer__links">
            <a href="https://www.drawio.com">draw.io</a>
            <a href="https://github.com/jgraph/drawio-tools">GitHub</a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
  <script src="../utils/drawio-tools.js"></script>
  <script>
    (function() {
      var DT = window.DrawioTools;

      var urlInput = document.getElementById('url');
      var titleInput = document.getElementById('title');
      var descInput = document.getElementById('desc');
      var resultCard = document.getElementById('resultCard');
      var resultLink = document.getElementById('resultLink');
      var alertContainer = document.getElementById('alertContainer');

      var generatedUrl = '';

      function showAlert(message, type) {
        DT.showToast(message, type);
      }

      function encode(data) {
        var compressed = pako.deflateRaw(encodeURIComponent(data));
        return btoa(String.fromCharCode.apply(null, new Uint8Array(compressed)));
      }

      function getDesc() {
        var data = descInput.value;
        var lines = data.split('\n');
        var result = [];

        for (var i = 0; i < lines.length; i++) {
          if (lines[i].charAt(0) !== '#' && lines[i].length > 0) {
            result.push('#' + lines[i]);
          }
        }

        return result.join('\n');
      }

      document.getElementById('createBtn').addEventListener('click', function() {
        var url = urlInput.value.trim();
        var title = titleInput.value.trim();

        var link = 'https://viewer.diagrams.net/';
        var params = [];

        params.push('desc=' + encode(JSON.stringify({
          url: url,
          format: 'csv',
          data: getDesc()
        })));

        if (title.length > 0) {
          params.push('title=' + encodeURIComponent(title));
        }

        link += '?' + params.join('&');

        resultCard.style.display = '';
        resultLink.href = link;
        resultLink.textContent = link;
        generatedUrl = link;
        document.getElementById('openBtn').style.display = '';
        document.getElementById('copyBtn').style.display = '';

        showAlert('Link generated', 'success');
      });

      document.getElementById('openBtn').addEventListener('click', function() {
        if (generatedUrl) {
          window.open(generatedUrl, '_blank');
        }
      });

      document.getElementById('copyBtn').addEventListener('click', function() {
        DT.copyToClipboard(generatedUrl).then(function(success) {
          showAlert(success ? 'Copied to clipboard' : 'Failed to copy', success ? 'success' : 'error');
        });
      });

      urlInput.focus();
    })();
  </script>
</body>
</html>
