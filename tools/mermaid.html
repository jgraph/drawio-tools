<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge" ><![endif]-->
<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Mermaid to draw.io</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<script type="text/javascript">
//<![CDATA[

function replaceEscapes() {
    var input = document.getElementById('textarea').value;
    // Replace Unicode escape sequences
    input = input.replace(/\\u([0-9A-Fa-f]{4})/g, (match, group) => 
        String.fromCharCode(parseInt(group, 16))
    );
    // Replace newline escape sequences
    document.getElementById('textarea').value = input.replace(/\\n/g, '\n');
}

function create()
{
  var value = document.getElementById('textarea').value;

  if (value == null || value.length == 0)
  {
    document.getElementById('link').innerHTML = 'No input';
  }
  else
  {
    var prefix = (window.location.search == '?dev=1') ? 'https://test.draw.io/?dev=1&' : 'https://www.draw.io/?';
    var link = prefix + 'create=' + encodeURIComponent(JSON.stringify({type: 'mermaid', data: value}));
    document.getElementById('link').innerHTML = '<a href="' + link + '" target="_blank">Link</a>';
    window.open(link);
  }
};
//]]>
</script>
</head>
<body style="color-scheme:light dark;">
  <h2>Mermaid diagram</h2>
  <textarea rows="20" cols="80" id="textarea" placeholder="Drop files here or enter text" spellcheck="false" autocomplete="off" autocorrect="off" autocapitalize="off"></textarea>
  <br/><br/>
  <button onclick="create();return false;">Create draw.io diagram</button>
  <button onclick="replaceEscapes();return false;">Replace Escapes</button>
  <span style="margin-left:4px;" id="link"></span>
<script type="text/javascript">
//<![CDATA[
// Enables dropping files
if (window.File != null && window.FileReader != null && window.FileList != null)
{
    function handleDrop(evt)
    {
        evt.stopPropagation();
        evt.preventDefault();

        if (evt.dataTransfer.files.length > 0)
        {
            var file = evt.dataTransfer.files[0];

            var reader = new FileReader();
            reader.onload = function (e)
            {
                evt.target.value = e.target.result;
            };
            reader.readAsText(file);
        }
    };

    function handleDragOver(evt)
    {
        evt.stopPropagation();
        evt.preventDefault();
    };

    // Setup the dnd listeners.
    var textarea = document.getElementById('textarea');

    textarea.addEventListener('dragover', handleDragOver, false);
    textarea.addEventListener('drop', handleDrop, false);
}
//]]>
</script>
</form>
</body>
</html>
